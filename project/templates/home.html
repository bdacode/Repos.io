{% extends "base.html" %}
{% load private_tags %}
{% block content %}

<header class="main_header">
    <h1>
        Repos.io
        <small>Manage your repositories !</small>
    </h1>
</header>

<div class="alert-message warning"><p><strong>/ ALPHA /</strong> Repos.io is actually in alpha stage, a lot of things could or will change, and the site can be really slow from time to time. <a href="http://github.com/twidi/Repos.io/">If you want to help...</a></p></div>

<div class="row">

<section class="span5">
    {% if user.is_authenticated %}
        <h1>Welcome back <em>{{ user.username }} </em>!</h1>

        {% with accounts=user.accounts.all %}

            {% if not accounts %}
                <p>You have no account associated.</p>
                <p><a class="btn primary large" href="{% url accounts_manage %}">Associate your account</a></p>
            {% else %}
                <p>Start by visiting one of your accounts :</p>
            <table>
                <tbody>
                    {% for account in accounts %}
                    <tr>
                        <td>
                        {% include "core/accounts/avatar.html" with size=16 %}
                        {% include "core/accounts/link.html" %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
                <p class='with-btn'><a class="btn" href="{% url accounts_manage %}">Manage your accounts</a></p>
            {% endif %}

        {% endwith %}

    {% else %}

        <h1>Welcome !</h1>
        <p><strong>Repos.io</strong> is here to help you organize repositories you own or follow on many sites (we call them providers), like Github, Bitbucket, Google Code...<em>*</em></p>
        <p>Just start by authenticate with a provider (you'll then be able to associate other accounts), and enjoy !</p>
        <p>You can see your accounts, your followers and following, your own repositories and the ones you follow on each providers, you can note them, star them, add private notes...</p>
        <p>Actually we only do read-only task on authorized providers, but later you'll be able to manage all your repositories here.</p>
        <p class='with-btn'><a class="btn primary large" href="{% url accounts_login %}">Authenticate with a provider</a></p>
        <p><em>* we only support Github right now, others will come later</em></p>

    {% endif %}

</section>

<section class="span4">

    {% with accounts_manager.get_last_fetched as last_accounts %}
        {% if last_accounts %}
            {% prepare_private last_accounts %}
            <h2>Last 20 users</h2>
            <table class="with_extras">
                <tbody>
                    {% for an_account in last_accounts %}
                    <tr>
                        <td>
                            {% include "core/accounts/avatar.html" with account=an_account size=16 %}
                            {% include "core/accounts/link.html" with account=an_account %}
                            {% include "core/list_extra.html" with obj=an_account %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% endif %}
    {% endwith %}

</section>

<section class="span7">

    {% with repositories_manager.get_last_fetched as last_repositories %}
        {% if last_repositories %}
            {% prepare_private last_repositories %}
            <h2>Last 20 repositories</h2>
            <table class="with_extras">
                <tbody>
                    {% for a_repository in last_repositories %}
                    <tr>
                        <td>
                            {% include "core/repositories/logo.html" with repository=a_repository size=16 %}
                            {% include "core/repositories/link.html" with repository=a_repository no_owner=1 %}
                            <small>by {% include "core/accounts/link.html" with account=a_repository.owner no_backend=1 %}</small>
                            {% include "core/list_extra.html" with obj=a_repository %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% endif %}
    {% endwith %}

</section>

</div>

{% endblock content %}
